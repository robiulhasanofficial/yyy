<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0f1724" />
  <title>Youth Yard — Ultra Modern (Adaptive v2)</title>
  <link rel="icon" type="image/png" href="img/create-a-flat-vector-logo-showing-book-p_4FPNyffjR5CzuovYTqnZcQ_UzTfgxNtRMKKQvp0hitxIA.jpeg">
  <style>
    /* ===================== THEME ===================== */
    :root {
      --bg-1: #0b1022;
      --bg-2: #071027;
      --text: #e6eef8;
      --muted: #9fb0c8;
      --glass: rgba(255,255,255,.08);
      --card: rgba(255,255,255,.06);
      --radius: 16px;
      --neon-1: #00f5ff;
      --neon-2: #ff00c8;
      --neon-3: #ffb703;
      --glow-soft: 0 0 60px rgba(0,245,255,.25), 0 0 30px rgba(255,0,200,.18);
      --logo-stroke: rgba(255,255,255,.25);
      --title-shadow: 0 8px 28px rgba(0,0,0,.45);
      --speed-multiplier: 1;   /* JS can override for device */
      --runner-count: 6;       /* JS can override for device */
    }

    /* Mobile gets a DIFFERENT palette + faster gradients */
    @media (max-width: 640px) {
      :root {
        --bg-1: #12081b; /* deep purple */
        --bg-2: #001a1f; /* deep teal */
        --neon-1: #60efff; /* cyan */
        --neon-2: #f000ff; /* magenta */
        --neon-3: #ffe760; /* lemon */
        --speed-multiplier: 1.15;
      }
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body { color: var(--text); background: linear-gradient(180deg, var(--bg-1), var(--bg-2)); overflow-x: hidden; }

    /* -------------- GLOBAL FX -------------- */
    .wrap { max-width: 1200px; margin: 0 auto; padding: 24px; position: relative; z-index: 2; }

    .glass { background: var(--glass); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,.08); border-radius: var(--radius); }

    .neon-text { background: linear-gradient(90deg, var(--neon-1), var(--neon-2)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; text-shadow: var(--title-shadow); letter-spacing: .3px; }

    /* -------------- HEADER -------------- */
    header { display: grid; grid-template-columns: auto 1fr; gap: 16px; align-items: center; margin-bottom: 18px; }
    header .logo { width: 60px; height: 60px; border-radius: 16px; overflow: hidden; box-shadow: var(--glow-soft); transform: translateZ(0); position: relative; }
    header .logo::after{ content:""; position:absolute; inset:0; border-radius: inherit; box-shadow: inset 0 0 0 1.2px var(--logo-stroke); pointer-events:none; }
    header .logo img{ width: 100%; height: 100%; object-fit: cover; display:block; }
    header h1 { font-size: clamp(1.6rem, 2.2vw + 1rem, 2.7rem); font-weight:800; letter-spacing:.4px; }
    header p { color: var(--muted); }

    /* -------------- HERO PARALLAX -------------- */
    .hero { position: relative; overflow: clip; border-radius: 22px; margin: 18px 0 22px; padding: clamp(18px, 3vw, 32px); }
    .hero::before { content: ""; position: absolute; inset: -30%; background: conic-gradient(from 180deg at 50% 50%, var(--neon-1), transparent 25%, var(--neon-2), transparent 60%, var(--neon-3)); filter: blur(40px); opacity:.18; animation: spin calc(18s / var(--speed-multiplier)) linear infinite; }
    .hero h2 { font-size: clamp(1.4rem, 3vw + .8rem, 2.4rem); margin-bottom: 6px; }
    .hero p { color: var(--muted); }

    @keyframes spin{ to{ transform: rotate(360deg) } }

    /* -------------- CAROUSEL -------------- */
    .carousel { position: relative; border-radius: 18px; overflow: hidden; background: var(--card); box-shadow: 0 12px 60px rgba(0,0,0,.35); isolation: isolate; }
    .slides { display: flex; transition: transform .7s cubic-bezier(.22,.9,.3,1); will-change: transform; }
    .slide { min-width: 100%; height: clamp(320px, 50vw, 520px); position: relative; background-size: cover; background-position: center; cursor: pointer; }
    .slide::after { content:""; position:absolute; inset:0; background: linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.55)); }
    .slide .overlay { position: absolute; inset: 0; padding: clamp(18px, 2.6vw, 32px); display:grid; align-content:end; z-index:1; }
    .slide h2{ font-size: clamp(1.05rem, 2.2vw + .6rem, 1.8rem); }
    .slide p{ color: var(--muted); margin-top: 6px; }

    .nav { position: absolute; inset: auto 12px 12px; display:flex; gap:10px; z-index:2; }
    .btn { background: var(--glass); border:1px solid rgba(255,255,255,.06); padding: 10px 12px; border-radius: 12px; color: var(--text); cursor: pointer; transition: transform .2s ease, background .3s ease; box-shadow: var(--glow-soft); }
    .btn:hover { transform: translateY(-2px) scale(1.03); }

    .dots { position: absolute; inset: auto 0 0 0; display:flex; gap:10px; padding: 12px 16px; justify-content:center; z-index:2; }
    .dot { width: 10px; height: 10px; border-radius: 999px; background: rgba(255,255,255,.22); cursor: pointer; transition: transform .2s ease, background .3s ease; }
    .dot.active { background: var(--neon-1); box-shadow: 0 0 10px var(--neon-1), 0 0 22px var(--neon-1); transform: scale(1.25); }

    .progress { position: absolute; inset: auto 0 0 0; height: 3px; background: linear-gradient(90deg, var(--neon-1), var(--neon-2)); transform-origin: left; transform: scaleX(0); animation: progress calc(5s / var(--speed-multiplier)) linear infinite; z-index:2; }
    .carousel:hover .progress { animation-play-state: paused; }
    @keyframes progress { from{ transform: scaleX(0) } to{ transform: scaleX(1) } }

    /* -------------- GRID CARDS -------------- */
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; margin: 22px 0 30px; }
    .card { grid-column: span 6; background: var(--card); border:1px solid rgba(255,255,255,.06); border-radius: 14px; overflow: clip; cursor: pointer; transition: transform .35s cubic-bezier(.2,.8,.2,1), box-shadow .35s; transform-style: preserve-3d; will-change: transform; }
    .card:hover { transform: perspective(800px) rotateX(6deg) rotateY(-6deg) scale(1.02); box-shadow: 0 18px 80px rgba(0,0,0,.45), 0 0 28px rgba(255,255,255,.07), 0 0 40px var(--neon-2); }
    .card img{ width:100%; height: 180px; object-fit: cover; display:block; }
    .card .body{ padding: 12px 14px 16px; }
    .card h3{ font-size: 1.05rem; margin:0 0 6px; }
    .card p{ color: var(--muted); }

    @media (max-width: 900px) { .card { grid-column: span 12; } }

    /* -------------- LIGHTBOX -------------- */
    #lightbox { position: fixed; inset: 0; display: none; place-items: center; background: rgba(0,0,0,.66); z-index: 50; }
    #lightbox img { max-width: 92vw; max-height: 92vh; transition: transform .2s ease; border-radius: 12px; box-shadow: 0 14px 80px rgba(0,0,0,.6), 0 0 40px var(--neon-1); }

    /* -------------- FOOTER -------------- */
    footer { border-radius: 22px; margin: 26px 0 40px; overflow: clip; }
    .footer-inner{ padding: 40px 20px; background: linear-gradient(45deg, #ff6b6b, #f7d794, #1dd1a1, #48dbfb); background-size: 400% 400%; animation: gradientBG calc(8s / var(--speed-multiplier)) ease infinite; }
    .footer-grid{ display:flex; flex-wrap:wrap; justify-content:space-between; gap: 24px; max-width: 1200px; margin: auto; }
    .socials{ display:flex; gap:16px; align-items:center; }
    .socials a{ display:inline-grid; place-items:center; width:44px; height:44px; border-radius: 12px; background: rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.16); transition: transform .2s, filter .2s; }
    .socials a:hover{ transform: translateY(-2px) scale(1.05); filter: drop-shadow(0 0 12px #fff); }
    .copyright{ text-align:center; padding: 12px; font-size: 14px; color: #fff; background: rgba(0,0,0,.2); }

    @keyframes gradientBG { 0%{ background-position:0% 50% } 50%{ background-position:100% 50% } 100%{ background-position:0% 50% } }

    /* -------------- PARTICLES CANVAS (behind everything) -------------- */
    #bg-canvas { position: fixed; inset: 0; z-index: 0; filter: saturate(1.15) blur(.3px); pointer-events: none; }

    /* -------------- GOOEY BLOBS (SVG) -------------- */
    .gooey { position: absolute; inset: 0; z-index: 1; pointer-events:none; mix-blend-mode: screen; opacity:.45; }
    .blob { filter: url(#goo); }

    /* -------------- SCROLL REVEAL -------------- */
    .reveal { opacity: 0; transform: translateY(18px) scale(.98); filter: blur(6px); transition: all .7s cubic-bezier(.2,.8,.2,1); }
    .reveal.show { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }

    /* -------------- CARTOON RUNNERS -------------- */
    .runner-layer { position: fixed; inset: 0; pointer-events: none; z-index: 3; }
    .runner { position: absolute; width: clamp(32px, 5vw, 64px); aspect-ratio: 1; display:grid; place-items:center; filter: drop-shadow(0 6px 18px rgba(0,0,0,.4)); will-change: transform; }
    .runner svg { width: 100%; height: 100%; }
    .runner .eye { transform-origin: 50% 50%; animation: blink calc(4s / var(--speed-multiplier)) infinite; }
    @keyframes blink { 0%, 97%, 100% { transform: scaleY(1) } 98% { transform: scaleY(.1) } }

    /* -------------- SETTINGS PANEL -------------- */
    .settings { position: fixed; right: 14px; bottom: 14px; z-index: 60; }
    .settings .panel { display:none; padding:14px; gap:10px; min-width: 260px; }
    .settings.open .panel { display:grid; }
    .settings .toggle { pointer-events:auto; background: var(--glass); border:1px solid rgba(255,255,255,.18); border-radius: 12px; padding: 10px 12px; cursor: pointer; box-shadow: var(--glow-soft); }
    .settings label { font-size: 12px; color: var(--muted); }
    .settings input[type="range"]{ width: 100%; }
    .select { background: var(--glass); border:1px solid rgba(255,255,255,.18); color: var(--text); border-radius: 10px; padding: 8px; }

    /* -------------- REDUCED MOTION -------------- */
    @media (prefers-reduced-motion: reduce) {
      .slides, .card, .btn, .dot, .hero::before, .progress, .eye { transition: none !important; animation: none !important; }
    }
  </style>
</head>
<body>
  <!-- Animated particles background -->
  <canvas id="bg-canvas" aria-hidden="true"></canvas>
  
  <!-- Runners layer (cartoon characters) -->
  <div class="runner-layer" id="runner-layer" aria-hidden="true"></div>

  <!-- Gooey neon blobs (SVG filter) -->
  <svg class="gooey" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid slice">
    <defs>
      <filter id="goo">
        <feGaussianBlur in="SourceGraphic" stdDeviation="6" result="blur" />
        <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 20 -10" result="goo"/>
        <feBlend in="SourceGraphic" in2="goo" />
      </filter>
      <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="var(--neon-1)"/>
        <stop offset="100%" stop-color="var(--neon-2)"/>
      </linearGradient>
      <linearGradient id="g2" x1="1" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="var(--neon-2)"/>
        <stop offset="100%" stop-color="var(--neon-3)"/>
      </linearGradient>
    </defs>
    <g class="blob">
      <circle cx="20" cy="40" r="14" fill="url(#g1)">
        <animate attributeName="cx" dur="18s" values="20;80;20" repeatCount="indefinite"/>
        <animate attributeName="cy" dur="16s" values="40;60;40" repeatCount="indefinite"/>
      </circle>
      <circle cx="80" cy="60" r="18" fill="url(#g2)">
        <animate attributeName="cx" dur="20s" values="80;30;80" repeatCount="indefinite"/>
        <animate attributeName="cy" dur="22s" values="60;35;60" repeatCount="indefinite"/>
      </circle>
      <circle cx="50" cy="20" r="12" fill="url(#g1)">
        <animate attributeName="cx" dur="16s" values="50;70;50" repeatCount="indefinite"/>
        <animate attributeName="cy" dur="14s" values="20;45;20" repeatCount="indefinite"/>
      </circle>
    </g>
  </svg>

  <div class="wrap">
    <header class="reveal">
      <div class="logo glass">
        <img loading="lazy" src="img/create-a-flat-vector-logo-showing-book-p_4FPNyffjR5CzuovYTqnZcQ_UzTfgxNtRMKKQvp0hitxIA.jpeg" alt="Youth Yard logo" />
      </div>
      <div>
        <h1 class="neon-text">Youth Yard</h1>
        <p>"Youth Yard হলো তরুণদের জন্য এক অনন্য আড্ডাস্থল, যেখানে পড়াশোনার ফাঁকে পাওয়া যাবে পেট ভরানো তৃপ্তি।"</p>
      </div>
    </header>

    <section class="hero glass reveal">
      <h2 class="neon-text">প্রযুক্তির সাথে এগিয়ে চলো</h2>
      <p>ডিজিটাল ভবিষ্যতের জন্য প্রস্তুত হও — আল্ট্রা-স্মুথ অ্যানিমেশন, নিওন গ্লো, আর মোবাইলে বিশেষ রঙ ও এফেক্টস।</p>
    </section>

    <!-- ===== Carousel ===== -->
    <div class="carousel reveal" id="carousel">
      <div class="slides" id="slides">
        <div class="slide" style="background-image:url('img/ChatGPT Image Aug 8, 2025, 06_48_44 PM.png')" onclick="openLightboxFromBg(this)">
          <div class="overlay"><h2>🥣 খিচুড়ি + হাফ ডিম = ২০ টাকা · 🥚 ফুল ডিম = ৩০ টাকা</h2><p>আজকের চেষ্টা তোমার আগামীকাল বদলাবে।</p></div>
        </div>
        <div class="slide" style="background-image:url('img/Welcome.png')" onclick="openLightboxFromBg(this)">
          <div class="overlay"><h2>প্রযুক্তির সাথে এগিয়ে চলো</h2><p>ডিজিটাল ভবিষ্যতের জন্য প্রস্তুত হও।</p></div>
        </div>
        <div class="slide" style="background-image:url('img/Welcome.png')" onclick="openLightboxFromBg(this)">
          <div class="overlay"><h2>দৃঢ় মনোবল, সফলতা নিশ্চিত</h2><p>কাজ শুরু করো আজই, সাফল্য অপেক্ষায়।</p></div>
        </div>
      </div>
      <div class="nav">
        <button class="btn" id="prev" aria-label="Previous">◀</button>
        <button class="btn" id="next" aria-label="Next">▶</button>
      </div>
      <div class="progress" id="progress"></div>
      <div class="dots" id="dots"></div>
    </div>

    <!-- ===== Grid of banners ===== -->
    <div class="grid">
      <div class="card reveal" onclick="openLightbox(this.querySelector('img').src)">
        <img loading="lazy" src="img/design_300dpi.png" alt="ডিজাইন পোস্টার" />
        <div class="body"><h3>রঙিন পোস্টার</h3><p>হাই-রেজ ডিজাইন, নিওন গ্লো।</p></div>
      </div>
      <div class="card reveal" onclick="openLightbox(this.querySelector('img').src)">
        <img loading="lazy" src="img/design_300dpi.png" alt="ডিজাইন পোস্টার" />
        <div class="body"><h3>বিশেষ অফার</h3><p>আকর্ষণীয় ডিল প্রতিদিন।</p></div>
      </div>
      <div class="card reveal" onclick="openLightbox(this.querySelector('img').src)">
        <img loading="lazy" src="img/Welcome.png" alt="মোটিভেশন" />
        <div class="body"><h3>প্রেরণা জাগাও</h3><p>নিজেকে নতুনভাবে গড়ে তোলো।</p></div>
      </div>
      <div class="card reveal" onclick="openLightbox(this.querySelector('img').src)">
        <img loading="lazy" src="img/ChatGPT Image Aug 11, 2025, 08_48_47 AM.png" alt="সাফল্যের পথে" />
        <div class="body"><h3>সাফল্যের পথে</h3><p>ধাপে ধাপে এগিয়ে যাও।</p></div>
      </div>
    </div>

    <!-- ===== Lightbox ===== -->
    <div id="lightbox" onclick="if(event.target.id==='lightbox')closeLightbox()" class="glass">
      <img id="lightbox-img" src="" alt="expanded" onclick="toggleZoom(event)">
    </div>

    <!-- ===== Footer ===== -->
    <footer class="reveal">
      <div class="footer-inner">
        <div class="footer-grid">
          <div style="flex:1; min-width:240px;">
            <h2 style="margin-bottom:10px; font-size:24px">Youth Yard</h2>
            <p>আপনার হাতে পৌঁছে দেই স্বাস্থ্যসম্মত খাবার, দ্রুত ডেলিভারির সাথে।</p>
          </div>
          <div style="flex:1; min-width:200px;">
            <h3 style="margin-bottom:10px;">দ্রুত লিঙ্ক</h3>
            <ul style="list-style:none; padding:0; line-height:1.9">
              <li><a href="#" style="color:white; text-decoration:none">হোম</a></li>
              <li><a href="#" style="color:white; text-decoration:none">আমাদের সম্পর্কে</a></li>
              <li><a href="#" style="color:white; text-decoration:none">মেনু</a></li>
              <li><a href="#" style="color:white; text-decoration:none">যোগাযোগ</a></li>
            </ul>
          </div>
          <div style="flex:1; min-width:220px;">
            <h3 style="margin-bottom:10px;">যোগাযোগ</h3>
            <div class="socials">
              <a href="https://www.facebook.com/profile.php?id=61579343277080" aria-label="Facebook"><img width="22" height="22" src="img/icons8-facebook-50.png" alt="facebook"></a>
              <a href="https://www.instagram.com/yard91864/" aria-label="Instagram"><img width="22" height="22" src="img/icons8-instagram-logo-50.png" alt="instagram"></a>
              <a href="https://www.reddit.com/user/Kitchen-Guide3939/" aria-label="Reddit"><img width="22" height="22" src="img/icons8-reddit.gif" alt="reddit"></a>
              <a href="https://x.com/youthyard_st" aria-label="X"><img width="22" height="22" src="img/icons8-twitter-bird.gif" alt="x"></a>
            </div>
          </div>
        </div>
        <div class="copyright">© 2025 Youth Yard. সর্বস্বত্ব সংরক্ষিত।</div>
      </div>
    </footer>
  </div>

  <!-- ===== Floating Settings ===== -->
  <div class="settings" id="settings">
    <button class="toggle">⚙️ Settings</button>
    <div class="panel glass">
      <div>
        <label>Theme preset</label>
        <select class="select" id="themeSelect">
          <option value="default">Neon Night (Default)</option>
          <option value="mobile">Mobile Neon</option>
          <option value="sunset">Sunset Pop</option>
          <option value="ocean">Ocean Candy</option>
        </select>
      </div>
      <div>
        <label>Animation speed</label>
        <select class="select" id="speedSelect">
          <option value="0.8">0.8×</option>
          <option value="1" selected>1×</option>
          <option value="1.25">1.25×</option>
          <option value="1.5">1.5×</option>
        </select>
      </div>
      <div>
        <label>Particles</label>
        <input type="range" id="particleRange" min="30" max="250" step="10">
      </div>
      <div>
        <label>Cartoon runners</label>
        <input type="range" id="runnerRange" min="0" max="20" step="1">
      </div>
      <div>
        <button id="autoPerf" class="toggle">Auto-Tune Performance</button>
      </div>
    </div>
  </div>

  <script>
    /* ===================== UTIL: theme presets ===================== */
    const THEMES = {
      default: {
        '--bg-1': '#0b1022', '--bg-2': '#071027', '--neon-1': '#00f5ff', '--neon-2': '#ff00c8', '--neon-3': '#ffb703'
      },
      mobile: {
        '--bg-1': '#12081b', '--bg-2': '#001a1f', '--neon-1': '#60efff', '--neon-2': '#f000ff', '--neon-3': '#ffe760'
      },
      sunset: {
        '--bg-1': '#2a0a1b', '--bg-2': '#1a0a28', '--neon-1': '#ff8a00', '--neon-2': '#ff3d81', '--neon-3': '#ffd36a'
      },
      ocean: {
        '--bg-1': '#041526', '--bg-2': '#001a27', '--neon-1': '#2ee6ff', '--neon-2': '#00ffa5', '--neon-3': '#a0ffea'
      }
    };
    function applyTheme(preset){ Object.entries(THEMES[preset]||THEMES.default).forEach(([k,v])=> document.documentElement.style.setProperty(k, v)); }

    /* ===================== PARTICLE BACKGROUND ===================== */
    (function(){
      const c = document.getElementById('bg-canvas');
      const ctx = c.getContext('2d');
      let W, H, DPR, particles = [], mouse={x:0,y:0};
      const MOBILE = matchMedia('(max-width:640px)').matches;

      function resize(){
        DPR = Math.min(window.devicePixelRatio || 1.5, 2.5);
        W = c.width = Math.floor(innerWidth * DPR);
        H = c.height = Math.floor(innerHeight * DPR);
        c.style.width = innerWidth + 'px';
        c.style.height = innerHeight + 'px';
        setParticles(getDesiredParticleCount());
      }

      function setParticles(count){
        particles.length = 0;
        for(let i=0;i<count;i++){
          particles.push({
            x: Math.random()*W, y: Math.random()*H,
            vx: (Math.random()-.5)*(MOBILE? .3:.5), vy: (Math.random()-.5)*(MOBILE? .3:.5),
            r: Math.random()*2 + 0.7,
            h: Math.random()*360,
          });
        }
      }

      function getDesiredParticleCount(){
        // Base on device cores & memory when available
        const cores = navigator.hardwareConcurrency || 4;
        const mem = navigator.deviceMemory || 4;
        const base = MOBILE? 80 : 140;
        let count = Math.round(base * (cores/4) * Math.min(mem/4, 1.2));
        // Allow user override
        const user = +localStorage.getItem('yy_particles') || 0;
        if(user) count = user;
        return Math.max(30, Math.min(count, 250));
      }

      function step(){
        ctx.clearRect(0,0,W,H);
        const spd = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--speed-multiplier')) || 1;
        for(const p of particles){
          p.x += p.vx*spd; p.y += p.vy*spd; p.h += (matchMedia('(max-width:640px)').matches? .15 : .08)*spd;
          if(p.x<0) p.x=W; if(p.x>W) p.x=0; if(p.y<0) p.y=H; if(p.y>H) p.y=0;
          ctx.beginPath();
          const dx = (mouse.x*(window.devicePixelRatio||1) - p.x)*0.0008;
          const dy = (mouse.y*(window.devicePixelRatio||1) - p.y)*0.0008;
          ctx.arc(p.x+dx*50, p.y+dy*50, p.r, 0, Math.PI*2);
          ctx.closePath();
          const s = matchMedia('(max-width:640px)').matches? '85%' : '70%';
          const l = matchMedia('(max-width:640px)').matches? '65%' : '55%';
          ctx.fillStyle = `hsla(${p.h%360}, ${s}, ${l}, .9)`;
          ctx.fill();
        }
        requestAnimationFrame(step);
      }

      addEventListener('resize', resize, {passive:true});
      addEventListener('mousemove', e=>{ mouse.x=e.clientX; mouse.y=e.clientY; }, {passive:true});
      addEventListener('touchmove', e=>{ if(e.touches[0]){ mouse.x=e.touches[0].clientX; mouse.y=e.touches[0].clientY; } }, {passive:true});
      resize(); step();

      // expose to settings
      window.__setParticleCount = (n)=>{ localStorage.setItem('yy_particles', n); setParticles(n); };
    })();

    /* ===================== SCROLL REVEAL ===================== */
    const io = new IntersectionObserver((entries)=>{
      for(const it of entries){ if(it.isIntersecting){ it.target.classList.add('show'); io.unobserve(it.target); } }
    }, { threshold: .15 });
    document.querySelectorAll('.reveal').forEach(el=> io.observe(el));

    /* ===================== CAROUSEL with swipe + progress ===================== */
    const slidesEl = document.getElementById('slides');
    const total = slidesEl.children.length;
    const dotsEl = document.getElementById('dots');
    const progressEl = document.getElementById('progress');
    let index = 0, autoplay = true, autoTimer;

    function go(i){
      index = (i+total)%total;
      slidesEl.style.transform = `translateX(${-index*100}%)`;
      updateDots();
      restartProgress();
    }
    function prev(){ go(index-1); }
    function next(){ go(index+1); }

    for(let i=0;i<total;i++){
      const d=document.createElement('div');
      d.className='dot';
      d.addEventListener('click',()=>{ autoplay=false; go(i); });
      dotsEl.appendChild(d);
    }
    function updateDots(){
      [...dotsEl.children].forEach((d,i)=> d.classList.toggle('active', i===index));
    }

    function restartProgress(){
      progressEl.style.animation='none'; progressEl.offsetHeight; // reflow
      progressEl.style.animation=null; // re-apply
      clearInterval(autoTimer);
      if(autoplay){ autoTimer = setInterval(next, 5000/parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--speed-multiplier'))); }
    }

    document.getElementById('prev').addEventListener('click',()=>{ autoplay=false; prev(); });
    document.getElementById('next').addEventListener('click',()=>{ autoplay=false; next(); });

    document.getElementById('carousel').addEventListener('mouseenter', ()=> autoplay=false);
    document.getElementById('carousel').addEventListener('mouseleave', ()=> { autoplay=true; restartProgress(); });

    (function(){
      const el = document.getElementById('carousel');
      let startX=0, dx=0, touching=false; 
      el.addEventListener('touchstart', (e)=>{ touching=true; autoplay=false; startX = e.touches[0].clientX; dx=0; }, {passive:true});
      el.addEventListener('touchmove', (e)=>{ if(!touching) return; dx = e.touches[0].clientX - startX; slidesEl.style.transform = `translateX(${-index*100 + (dx/innerWidth)*100}%)`; }, {passive:true});
      el.addEventListener('touchend', ()=>{ touching=false; if(Math.abs(dx) > innerWidth*0.15){ dx<0? next(): prev(); } else { go(index); } }, {passive:true});
    })();

    go(0);

    /* ===================== LIGHTBOX ===================== */
    let zoomed=false;
    function openLightbox(src){
      document.getElementById('lightbox-img').src=src; 
      document.getElementById('lightbox').style.display='grid';
      zoomed=false; document.getElementById('lightbox-img').style.transform='scale(1)';
    }
    function openLightboxFromBg(el){
      const s = getComputedStyle(el).backgroundImage;
      const clean = s.replace(/^url\(["']?/, '').replace(/["']?\)$/,'');
      openLightbox(clean);
    }
    function closeLightbox(){ document.getElementById('lightbox').style.display='none'; }
    function toggleZoom(e){ zoomed=!zoomed; e.target.style.transform = zoomed ? 'scale(2)' : 'scale(1)'; e.target.style.cursor = zoomed? 'zoom-out':'zoom-in'; }
    window.openLightbox = openLightbox; window.closeLightbox = closeLightbox; window.toggleZoom = toggleZoom; window.openLightboxFromBg = openLightboxFromBg;

    /* ===================== CARTOON RUNNERS ===================== */
    (function(){
      const layer = document.getElementById('runner-layer');
      const MOBILE = matchMedia('(max-width:640px)').matches;

      const COLORS = ['var(--neon-1)','var(--neon-2)','var(--neon-3)'];
      const runners = [];

      function makeRunner(){
        const el = document.createElement('div');
        el.className='runner';
        el.innerHTML = `
          <svg viewBox="0 0 100 100" aria-hidden="true">
            <defs>
              <linearGradient id="b${Math.random().toString(36).slice(2)}" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="${COLORS[Math.floor(Math.random()*COLORS.length)]}" />
                <stop offset="100%" stop-color="${COLORS[Math.floor(Math.random()*COLORS.length)]}" />
              </linearGradient>
            </defs>
            <g>
              <circle cx="50" cy="50" r="40" fill="url(#b${Math.random().toString(36).slice(2)})"/>
              <circle class="eye" cx="35" cy="42" r="6" fill="#fff"/>
              <circle class="eye" cx="65" cy="42" r="6" fill="#fff"/>
              <path d="M30,65 C40,75 60,75 70,65" stroke="#fff" stroke-width="6" fill="none" stroke-linecap="round"/>
              <circle cx="20" cy="80" r="10" fill="rgba(255,255,255,.2)">
                <animate attributeName="cx" dur="1.2s" values="20;80;20" repeatCount="indefinite"/>
              </circle>
            </g>
          </svg>`;
        layer.appendChild(el);
        return {el, x: Math.random()*innerWidth, y: Math.random()*innerHeight*0.8, vx: (Math.random()*.6+.3)*(Math.random()<.5?1:-1), vy:(Math.random()*.6+.3)*(Math.random()<.5?1:-1)};
      }

      function setRunnerCount(n){
        // remove excess
        while(runners.length > n){ const r = runners.pop(); r.el.remove(); }
        // add missing
        while(runners.length < n){ runners.push(makeRunner()); }
      }

      function step(){
        const spd = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--speed-multiplier')) || 1;
        for(const r of runners){
          r.x += r.vx * (MOBILE? 1.1:1) * spd;
          r.y += r.vy * (MOBILE? 1.1:1) * spd;
          if(r.x < 0 || r.x > innerWidth - 40) r.vx *= -1;
          if(r.y < 0 || r.y > innerHeight - 40) r.vy *= -1;
          r.el.style.transform = `translate(${r.x}px, ${r.y}px)`;
        }
        requestAnimationFrame(step);
      }

      // init based on device + user setting
      const base = Math.round((MOBILE? 5:8) * ((navigator.hardwareConcurrency||4)/4));
      const saved = +localStorage.getItem('yy_runners') || base;
      setRunnerCount(Math.min(20, saved));
      step();

      // expose to settings
      window.__setRunnerCount = (n)=>{ localStorage.setItem('yy_runners', n); setRunnerCount(n); };
    })();

    /* ===================== SETTINGS (speed/theme/particle/runner) ===================== */
    (function(){
      const panelWrap = document.getElementById('settings');
      const toggleBtn = panelWrap.querySelector('.toggle');
      const themeSelect = document.getElementById('themeSelect');
      const speedSelect = document.getElementById('speedSelect');
      const particleRange = document.getElementById('particleRange');
      const runnerRange = document.getElementById('runnerRange');
      const autoBtn = document.getElementById('autoPerf');

      // hydrate from storage
      themeSelect.value = localStorage.getItem('yy_theme') || (matchMedia('(max-width:640px)').matches? 'mobile':'default');
      speedSelect.value = localStorage.getItem('yy_speed') || '1';
      particleRange.value = localStorage.getItem('yy_particles') || 0;
      runnerRange.value = localStorage.getItem('yy_runners') || 0;

      // apply
      applyTheme(themeSelect.value);
      document.documentElement.style.setProperty('--speed-multiplier', parseFloat(speedSelect.value));

      toggleBtn.addEventListener('click', ()=> panelWrap.classList.toggle('open'));
      themeSelect.addEventListener('change', ()=>{ applyTheme(themeSelect.value); localStorage.setItem('yy_theme', themeSelect.value); });
      speedSelect.addEventListener('change', ()=>{ const v= parseFloat(speedSelect.value); document.documentElement.style.setProperty('--speed-multiplier', v); localStorage.setItem('yy_speed', v); });

      particleRange.addEventListener('input', ()=>{ const n= +particleRange.value; window.__setParticleCount(n); });
      runnerRange.addEventListener('input', ()=>{ const n= +runnerRange.value; window.__setRunnerCount(n); });

      // Auto performance tuner: samples FPS and adjusts counts
      autoBtn.addEventListener('click', ()=>{
        let frames=0; let start=performance.now();
        function sample(){
          frames++;
          if(performance.now()-start < 1000){ requestAnimationFrame(sample); }
          else{
            const fps = frames; // approx fps/sec
            let scale = 1;
            if(fps < 40) scale = 0.7; // slow device
            if(fps < 28) scale = 0.5; // very slow
            const curParticles = +localStorage.getItem('yy_particles') || 0;
            const curRunners = +localStorage.getItem('yy_runners') || 0;
            const newParticles = Math.max(40, Math.round((curParticles||140) * scale));
            const newRunners = Math.round((curRunners||8) * scale);
            window.__setParticleCount(newParticles); particleRange.value = newParticles; localStorage.setItem('yy_particles', newParticles);
            window.__setRunnerCount(newRunners); runnerRange.value = newRunners; localStorage.setItem('yy_runners', newRunners);
            const newSpeed = scale<1? 0.9: 1.1; // mild tweak
            document.documentElement.style.setProperty('--speed-multiplier', newSpeed);
            localStorage.setItem('yy_speed', newSpeed);
          }
        }
        requestAnimationFrame(sample);
      });
    })();
  </script>
</body>
</html>